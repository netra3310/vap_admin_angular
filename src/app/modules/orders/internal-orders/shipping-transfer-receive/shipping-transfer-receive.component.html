<app-loading [status]="IsSpinner"></app-loading>
<div class="mb-5 text-end">
    <a (click)="Receive();" class="btn btn-sm fw-bold btn-primary">
        <span class="svg-icon svg-icon-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-files" viewBox="0 0 16 16">
                <path d="M13 0H6a2 2 0 0 0-2 2 2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2 2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 13V4a2 2 0 0 0-2-2H5a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1zM3 4a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4z"/>
            </svg>
        </span>
        <span >Receive</span>
    </a> 
    <!-- end the select date dropdown -->
    <!--begin::Primary button-->
    <a (click)="viewDocuments();" class="ms-5 btn btn-sm fw-bold btn-success me-5">
        <span class="svg-icon svg-icon-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-files" viewBox="0 0 16 16">
                <path d="M13 0H6a2 2 0 0 0-2 2 2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2 2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 13V4a2 2 0 0 0-2-2H5a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1zM3 4a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4z"/>
            </svg>
        </span>
        <span >Documents</span>
    </a> 
    <!--end::Primary button-->
    <!--begin::Primary button-->
    <a (click)="cancelClick();" class="btn btn-sm fw-bold btn-secondary">
        <span class="svg-icon svg-icon-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-repeat" viewBox="0 0 16 16">
                <path d="M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192Zm3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"/>
            </svg>
        </span>
        <span >Close</span>
    </a> 
    <!--end::Primary button-->
</div>
<div class="card">
    <!--begin::Body-->
    <div class="card-body p-lg-20">
        <!--begin::Layout-->
        <div class="d-flex flex-column flex-xl-row">
            <!--begin::Content-->
            
            <div class="d-flex flex-column flex-lg-row-fluid gap-7 gap-lg-10">
                <!--begin::Order details-->
                <div class="card card-flush py-4">
                    <div class="card-body p-0">
                        <div class="d-flex flex-column gap-10">
                            <div class="">
                                <div class="card card-flush min-h-500px">
                                    <!--begin::Card header-->
                                    <div class="card-header align-items-center py-5 gap-2 gap-md-5">
                                        <!--begin::Card title-->
                                        <div class="card-title">
                                            <!--begin::Search-->
                                            <div class="d-flex align-items-center position-relative my-1">
                                                Shipping
                                            </div>
                                            <!--end::Search-->
                                        </div>
                                        <!--end::Card title-->
                                        <!--begin::Card toolbar-->
                                        <div class="d-flex justify-content-end">
                                            <div class="card-toolbar flex-row-fluid justify-content-start gap-5">
                                                <!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
                                                <span class="svg-icon svg-icon-1 position-absolute ms-4">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1" transform="rotate(45 17.0365 15.1223)" fill="currentColor" />
                                                        <path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z" fill="currentColor" />
                                                    </svg>
                                                </span>
                                                <!--end::Svg Icon-->
                                                <input type="text" class="form-control form-control-solid w-250px ps-14" placeholder="Search Product" (keyup)="searchData()" [(ngModel)]="searchKey"/>
                                            </div>
                                        </div>
                                        <!--end::Card toolbar-->
                                    </div>
                                    <!--end::Card header-->
                                    <!--begin::Card body-->
                                    <div class="card-body pt-0 overflow-auto">
                                        <!--begin::Table-->
                                        <table class="table align-middle table-row-dashed fs-6 gy-5">
                                            <!--begin::Table head-->
                                            <thead>
                                                <!--begin::Table row-->
                                                <tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
                                                    <th class="min-w-200px">Product</th>
                                                    <th class="text-end min-w-100px">Quantity</th>
                                                    <th class="text-end min-w-70px">Old Received Quantity</th>
                                                    <th class="text-end min-w-100px">Received Quantity</th>
                                                </tr>
                                                <!--end::Table row-->
                                            </thead>
                                            <!--end::Table head-->
                                            <!--begin::Table body-->
                                            <tbody class="fw-semibold text-gray-600">
                                                <ng-container *ngFor="let item of showItems">
                                                    <!--begin::Table row-->
                                                    <tr>
                                                        <!--begin::Category=-->
                                                        <td>
                                                            <div class="d-flex align-items-center">
                                                                <div class="ms-5">
                                                                    <!--begin::Title-->
                                                                    <span>
                                                                        {{item.Product}}
                                                                    </span>
                                                                    <!--end::Title-->
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <!--end::Category=-->
                                                        <!--begin::Qty=-->
                                                        <td class="text-end pe-0" data-order="30">
                                                            <span class="fw-bold ms-3">{{item.Quantity}}</span>
                                                        </td>
                                                        <!--end::Qty=-->
                                                        <td class="text-end pe-0">
                                                            <span>{{item.OldReceivedQuantity}}</span>
                                                        </td>
                                                        <!--begin::Qty=-->
                                                        <td class="text-end pe-0" data-order="30">
                                                            <input  class="form-control mw-100px m-auto" 
                                                                type="number" 
                                                                [(ngModel)]="item.ReceivedQuantity"
                                                                (keyup)="OnChangeText($event, item)">
                                                        </td>
                                                        <!--end::Qty=-->
                                                        <!--begin::Action=-->
                                                        <td class="text-end" *ngIf="item.IsTrackable">
                                                            <a class="btn btn-sm fw-bold btn-primary ms-2"
                                                                (click)="openTrackableDialog(item)" >
                                                                <span>
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg me-2" viewBox="0 0 16 16">
                                                                        <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                                                                    </svg>
                                                                </span>
                                                            </a>
                                                            <a class="btn btn-sm fw-bold btn-primary ms-2"
                                                                (click)="openProductTrackableDetailsDialog(item)">
                                                                <span>
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                                                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                                                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                                                                    </svg>
                                                                </span>
                                                            </a>
                                                        </td>
                                                        <!--end::Action=-->
                                                    </tr>
                                                    <!--end::Table row-->
                                                </ng-container>
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--end::Content-->
            <!--begin::Sidebar-->
            <div class="m-0">
                <!--begin::Invoice 2 sidebar-->
                <div class="d-print-none border border-dashed border-gray-300 card-rounded h-lg-100 min-w-md-350px p-9 bg-lighten">
                    <div class="py-5 fs-6">
                        
                        <h6 class="mb-8 fw-bolder text-gray-600 text-hover-primary">DETAILS</h6>
                        <div class="row">
                            <div class="col-6">
                                <div class="badge badge-light-primary d-inline mb-2">FROM</div>
                                <div class="text-gray-600">{{FromOutLetData.Name}}</div>
                                <div class="text-gray-600">{{FromOutLetData.PhoneNo}}</div>
                                <div class="text-gray-600">{{FromOutLetData.City}}</div>
                            </div>
                            <div class="col-6"> 
                                <div class="badge badge-light-warning d-inline mb-2">TO</div>
                                <div class="text-gray-600">{{ToOutLetData.Name}}</div>
                                <div class="text-gray-600">{{ToOutLetData.PhoneNo}}</div>
                                <div class="text-gray-600">{{ToOutLetData.City}}</div>
                            </div>
                        </div>

                        <div class="separator mt-2 mb-2"></div>
                        
                        <div class="fw-bold mt-5">
                             
                            <div class="badge badge-light-success d-inline mb-2 me-3">Shipment Date:</div>
                            <span class="text-gray-600">{{ selectedshipping?.dtDate | date: 'M/dd/yyyy h:m:s a'}}</span>
                        </div>

                        <div class="fw-bold mt-5">
                            <div class="badge badge-light-success d-inline mb-2 me-3">Receive Date:  </div>
                            <span class="text-gray-600">
                                {{selectedshipping?.ReceivedDate ? (selectedshipping?.ReceivedDate | date: 'M/dd/yyyy h:m:s a') : 'Not yet received'}} 
                            </span>
                        </div>

                        <div class="fw-bold mt-5"> 
                            <div class="badge badge-light-success d-inline mb-2 me-3">
                                Tracking Code: 
                            </div>
                            <span class="text-gray-600">
                                {{selectedshipping?.TrackingCode}}
                            </span>
                        </div>

                        <div class="fw-bold mt-5">
                            <div class="badge badge-light-success d-inline mb-2 me-3">
                                Tracking Website:  
                            </div>
                            <span class="text-gray-600">
                                {{selectedshipping?.TrackingWebsite}}
                            </span>
                        </div>
                        <div class="separator mt-2 mb-2"></div>
                        <div>
                            <!--begin::Label-->
                            <label class="required form-label">
                                <span [inlineSVG]="'./assets/media/icons/duotune/general/gen014.svg'"
                                    class="svg-icon svg-icon-1 me-1"
                                ></span>
                                Receipt Date
                            </label>
                            
                            <app-custom-date-picker [(twBinding)]="ReceivingDate" [showIcon]="true" inputId="icon"></app-custom-date-picker>
                        </div>
                        
                        <div class="separator mt-2 mb-2"></div>
                        <div class="fw-bold mt-5 mb-5">
                            <div class="badge badge-light-success d-inline mb-2 me-3">
                                Delivery Method: 
                            </div>
                            <span class="text-gray-600">
                                {{ selectedshipping?.ShippingMethod}}
                            </span>
                        </div>

                        <div class="mb-6">
                            <div class="fw-semibold text-gray-600 fs-7">Remarks</div>
                            <textarea id="remarks" type="text" rows="3" cols="30" class="form-control"
                                                [(ngModel)]="selectedshipping.sRemarks"></textarea>
                        </div>
                        
                        <div class="separator mt-2 mb-2"></div>
                        
                        <!--begin::Container-->
                        <div class="d-flex justify-content-end">
                            <!--begin::Section-->
                            <div class="mw-300px">
                                <!--begin::Item-->
                                <div class="d-flex flex-stack mb-3">
                                    <!--begin::Accountname-->
                                    <div class="fw-semibold pe-10 text-gray-600 fs-7">Total Shipped Quantity:</div>
                                    <!--end::Accountname-->
                                    <!--begin::Label-->
                                    <div class="text-end fw-bold fs-6 text-gray-800">{{totalQuantity}}</div>
                                    <!--end::Label-->
                                </div>
                                <!--end::Item-->
                                <!--begin::Item-->
                                <div class="d-flex flex-stack mb-3">
                                    <!--begin::Accountname-->
                                    <div class="fw-semibold pe-10 text-gray-600 fs-7">Total Received Quantity </div>
                                    <!--end::Accountname-->
                                    <!--begin::Label-->
                                    <div class="text-end fw-bold fs-6 text-gray-800">{{NewReceivedQuantity}}</div>
                                    <!--end::Label-->
                                </div>
                                <!--end::Item-->
                            </div>
                            <!--end::Section-->
                        </div>
                        <!--end::Container-->
                    </div>
                </div>
                <!--end::Invoice 2 sidebar-->
            </div>
            <!--end::Sidebar-->
        </div>
        <!--end::Layout-->
    </div>
    <!--end::Body-->
</div>

<button type="button" hidden class="btn btn-primary" #btn_open_modal_documents data-bs-toggle="modal" data-bs-target="#modalDocuments">
    Open documents modal
</button>
<jw-modal [modalId]="'modalDocuments'" [modalTitle]="'Documents'" [modalSize]="'xl'">
    <ng-container *ngIf="selectedshipping.ShipmentDocuments">
        <div class="card card-flush py-4">
            <div class="card-body pt-0">
                <div class="d-flex flex-column gap-10">
                    <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
                        <app-genric-table 
                            (emitRowClick)="selectValue($event)" 
                            [menuItems]="[]" 
                            [data]="selectedshipping.ShipmentDocuments"
                            [columnsData]="documentsColumns" 
                            [globalFilterFields]="documentGlobalFilterFields" 
                            [rowsPerPageOptions]="rowsPerPageOptions"
                            [loadingData]="IsSpinner" 
                            [min_height]="'low'"
                            [row]='10'>
                        </app-genric-table>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</jw-modal>